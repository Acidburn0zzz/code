# Process this file with autom4te to create testsuite. -*- Autotest -*-

# Test suite for NeXus.
# Copyright (C) Jens Krueger, jens.krueger@frm2.tum.de.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
# 02111-1307, USA.

# We need a recent Autotest.
m4_version_prereq([2.57])

AT_INIT
dnl AT_TESTED(NXtest.f90)

AT_BANNER([[Testing the NeXus C library.]])

AT_SETUP([Check the HDF4 binding])
AT_CHECK([ $HAVE_HDF4 && napi_test-hdf4 | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.hdf
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   i1_data(20) =  1 2 3 4
   i2_data(22) =  1000 2000 3000 4000
   i4_data(24) =  1000000 2000000 3000000 4000000
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: data(NXdata)
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the HDF5 binding])
AT_CHECK([ $HAVE_HDF5 && napi_test-hdf5 | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.h5
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   Subgroup: data(NXdata)
   i1_data(20) =  1 2 3 4 
   i2_data(22) =  1000 2000 3000 4000 
   i4_data(24) =  1000000 2000000 3000000 4000000 
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the HDF4 binding (static library)])
AT_CHECK([ $HAVE_HDF4 && napi_test-hdf4-static | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.hdf
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   i1_data(20) =  1 2 3 4 
   i2_data(22) =  1000 2000 3000 4000 
   i4_data(24) =  1000000 2000000 3000000 4000000 
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: data(NXdata)
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the HDF5 binding (static library)])
AT_CHECK([ $HAVE_HDF5 && napi_test-hdf5-static | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.h5
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   Subgroup: data(NXdata)
   i1_data(20) =  1 2 3 4 
   i2_data(22) =  1000 2000 3000 4000 
   i4_data(24) =  1000000 2000000 3000000 4000000 
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the XML binding])
AT_CHECK([ $HAVE_XML && napi_test-xml | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.xml
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   i1_data(20) =  1 2 3 4
   i2_data(22) =  1000 2000 3000 4000
   i4_data(24) =  1000000 2000000 3000000 4000000
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: data(NXdata)
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the XML binding (static library)])
AT_CHECK([ $HAVE_XML && napi_test-xml-static | sed -e 's/\r$//' ], [], 
[[Number of global attributes: 4
   NeXus_version = 3.0.0
   file_name = NXtest.xml
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   i1_data(20) =  1 2 3 4
   i2_data(22) =  1000 2000 3000 4000
   i4_data(24) =  1000000 2000000 3000000 4000000
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000
       5.000000 6.000000 7.000000 8.000000
       9.000000 10.000000 11.000000 12.000000
       13.000000 14.000000 15.000000 16.000000
       17.000000 18.000000 19.000000 20.000000
      Number of attributes : 4
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
         target : /entry/r8_data
   Subgroup: data(NXdata)
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_BANNER([Check the FORTRAN 77 binding.])

AT_SETUP([Check the F77 binding using HDF4.])
AT_CHECK([ $HAVE_F77 && $HAVE_HDF4 && napif_test-hdf4 | sed -e 's/\r$//' ], [], 
[[ Number of global attributes:  4
    NeXus_version = 3.0.0
    file_name = NXtest.nxs
 Group: entry(NXentry) contains  8 items
    ch_data( 4)
    Values : NeXus data
    i1_data(20)
    Values :   1  2  3  4
    i2_data(22)
    Values :   1000  2000  3000  4000
    i4_data(24)
    Values :      1000000     2000000     3000000     4000000
    r4_data( 5)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
    r8_data( 6)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
       ch_attribute : NeXus
       i4_attribute :    42
       r4_attribute :   3.141593
       target : /entry/r8_data
    Subgroup: data(NXdata)
    Subgroup: sample(NXsample)
 Link Check OK
]])
AT_CLEANUP

AT_SETUP([Check the F77 binding using HDF5.])
AT_CHECK([ $HAVE_F77 && $HAVE_HDF5 && napif_test-hdf5 | sed -e 's/\r$//' ], [], 
[[ Number of global attributes:  4
    NeXus_version = 3.0.0
    file_name = NXtest.nxs
 Group: entry(NXentry) contains  8 items
    ch_data( 4)
    Values : NeXus data
    Subgroup: data(NXdata)
    i1_data(20)
    Values :   1  2  3  4
    i2_data(22)
    Values :   1000  2000  3000  4000
    i4_data(24)
    Values :      1000000     2000000     3000000     4000000
    r4_data( 5)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
    r8_data( 6)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
       ch_attribute : NeXus
       i4_attribute :    42
       r4_attribute :   3.141593
       target : /entry/r8_data
    Subgroup: sample(NXsample)
 Link Check OK
]])
AT_CLEANUP

AT_SETUP([Check the F90 binding using HDF5.])
AT_CHECK([ $HAVE_F90 && $HAVE_HDF5 && NXtest | sed -e 's/\r$//' ], [], 
[[ Writing character data
 Number of global attributes:  4
    NeXus_version = 3.0.0
    file_name = NXtest.nxs
 Group: entry(NXentry) contains  8 items
    ch_data : NX_CHAR
    Values : NeXus data
    Subgroup: data(NXdata)
    i1_data : NX_INT8
    Values :  1 2 3 4
    i2_data : NX_INT16
    Values :  1000 2000 3000 4000
    i4_data : NX_INT32
    Values :  1000000 2000000 3000000 4000000
    r4_data : NX_FLOAT32
   Values :    1.0000000   2.0000000   3.0000000   4.0000000
          :    5.0000000   6.0000000   7.0000000   8.0000000
          :    9.0000000  10.0000000  11.0000000  12.0000000
          :   13.0000000  14.0000000  15.0000000  16.0000000
          :   17.0000000  18.0000000  19.0000000  20.0000000
    r8_data : NX_FLOAT64
   Values :    1.0000000   2.0000000   3.0000000   4.0000000
          :    5.0000000   6.0000000   7.0000000   8.0000000
          :    9.0000000  10.0000000  11.0000000  12.0000000
          :   13.0000000  14.0000000  15.0000000  16.0000000
          :   17.0000000  18.0000000  19.0000000  20.0000000
    ch_attribute : NeXus
    i4_attribute :  42
   r4_attribute :    3.1415930
    target : /entry/r8_data
    Subgroup: sample(NXsample)
 Link Check OK
]])
AT_CLEANUP

AT_BANNER([[Testing the NeXus File Converter.]])
AT_SETUP([Checking HDF4 -> HDF4 ])
AT_CHECK([$HAVE_HDF4 && nxconvert -h4 NXtest.hdf a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.hdf to HDF4 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking HDF4 -> HDF5 ])
AT_CHECK([$HAVE_HDF4 && $HAVE_HDF5 && nxconvert -h5 NXtest.hdf a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.hdf to HDF5 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking HDF4 -> XML ])
AT_CHECK([$HAVE_HDF4 && $HAVE_XML && nxconvert -x NXtest.hdf a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.hdf to XML NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking HDF5 -> HDF4 ])
AT_CHECK([$HAVE_HDF5 && $HAVE_HDF4 && nxconvert -h4 NXtest.h5 a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.h5 to HDF4 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking HDF5 -> HDF5 ])
AT_CHECK([$HAVE_HDF5 && nxconvert -h5 NXtest.h5 a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.h5 to HDF5 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking HDF5 -> XML ])
AT_CHECK([$HAVE_HDF5 && $HAVE_XML && nxconvert -x NXtest.h5 a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.h5 to XML NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking XML -> HDF4 ])
AT_CHECK([$HAVE_XML && $HAVE_HDF4 && nxconvert -h4 NXtest.xml a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.xml to HDF4 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking XML -> HDF5 ])
AT_CHECK([$HAVE_XML && $HAVE_HDF5 && nxconvert -h5 NXtest.xml a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.xml to HDF5 NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
AT_SETUP([Checking XML -> XML ])
AT_CHECK([$HAVE_XML && nxconvert -x NXtest.xml a.a | sed -e 's/\r$//' ],[], 
[[Converting NXtest.xml to XML NeXus file a.a
Convertion successful.
]])
AT_CLEANUP
