# Process this file with autom4te to create testsuite. -*- Autotest -*-

# Test suite for NeXus.
# Copyright (C) Jens Krueger, jens.krueger@frm2.tum.de.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
# 02111-1307, USA.

# We need a recent Autotest.
m4_version_prereq([2.57])

AT_INIT
AT_TESTED(NXtest.f90)

AT_BANNER([[Testing the NeXus C library.]])

AT_SETUP([Check the HDF4 binding])
AT_CHECK([napi_test-hdf4], [], 
[[Number of global attributes: 4
   NeXus_version = 2.1.0
   file_name = NXtest.nx4
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   i1_data(20) = 1 2 3 4 
   i2_data(22) = 1000 2000 3000 4000 
   i4_data(24) = 1000000 2000000 3000000 4000000 
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
      Number of attributes : 3
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
   Subgroup: data(NXdata)
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_SETUP([Check the HDF5 binding])
AT_CHECK([napi_test-hdf5], [], 
[[Number of global attributes: 4
   NeXus_version = 2.1.0
   file_name = NXtest.nx5
Group: entry(NXentry) contains 8 items
   ch_data(4) = NeXus data
   Subgroup: data(NXdata)
   i1_data(20) = 1 2 3 4 
   i2_data(22) = 1000 2000 3000 4000 
   i4_data(24) = 1000000 2000000 3000000 4000000 
   r4_data(5)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
   r8_data(6)
       1.000000 2.000000 3.000000 4.000000 
       5.000000 6.000000 7.000000 8.000000 
       9.000000 10.000000 11.000000 12.000000 
       13.000000 14.000000 15.000000 16.000000 
       17.000000 18.000000 19.000000 20.000000 
      Number of attributes : 3
         ch_attribute : NeXus
         i4_attribute : 42
         r4_attribute : 3.141593
   Subgroup: sample(NXsample)
Link check OK
NXopenpath checks OK
]])
AT_CLEANUP

AT_BANNER([Check the FORTRAN binding.])

AT_SETUP([Check the F77 binding.])
AT_CHECK([napif_test], [], 
[[ Number of global attributes:  4
    NeXus_version = 2.1.0
    file_name = NXtest.nxs
 Group: entry(NXentry) contains  8 items
    ch_data( 4)
    Values : NeXus data
    i1_data(20)
    Values :   1  2  3  4
    i2_data(22)
    Values :   1000  2000  3000  4000
    i4_data(24)
    Values :      1000000     2000000     3000000     4000000
    r4_data( 5)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
    r8_data( 6)
    Values :    1.00   2.00   3.00   4.00
           :    5.00   6.00   7.00   8.00
           :    9.00  10.00  11.00  12.00
           :   13.00  14.00  15.00  16.00
           :   17.00  18.00  19.00  20.00
       ch_attribute : NeXus
       i4_attribute :    42
       r4_attribute :   3.141593
    Subgroup: data(NXdata)
    Subgroup: sample(NXsample)
 Link Check OK
]])
AT_CLEANUP

AT_SETUP([Check the F90 binding.])
AT_CHECK([NXtest], [], 
[[ Writing character data
 Number of global attributes:  4
    NeXus_version = 2.1.0
    file_name = NXtest.nxs
 Group: entry(NXentry) contains  8 items
    ch_data : NX_CHAR 
    Values : NeXus data 
    Subgroup: data(NXdata)
    i1_data : NX_INT8 
    Values :  1 2 3 4
    i2_data : NX_INT16 
    Values :  1000 2000 3000 4000
    i4_data : NX_INT32 
    Values :  1000000 2000000 3000000 4000000
    r4_data : NX_FLOAT32
    Values :  1.000000000 2.000000000 3.000000000 4.000000000
           :  5.000000000 6.000000000 7.000000000 8.000000000
           :  9.000000000 10.00000000 11.00000000 12.00000000
           :  13.00000000 14.00000000 15.00000000 16.00000000
           :  17.00000000 18.00000000 19.00000000 20.00000000
    r8_data : NX_FLOAT64
    Values :  1.000000000 2.000000000 3.000000000 4.000000000
           :  5.000000000 6.000000000 7.000000000 8.000000000
           :  9.000000000 10.00000000 11.00000000 12.00000000
           :  13.00000000 14.00000000 15.00000000 16.00000000
           :  17.00000000 18.00000000 19.00000000 20.00000000
    ch_attribute : NeXus 
    i4_attribute :  42
    r4_attribute :  3.141592741
    Subgroup: sample(NXsample)
 Link Check OK
]])
AT_CLEANUP
