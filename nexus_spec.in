# @configure_input@
# $Id$
# Template for NeXus RPM SPEC file
# Copyright (C) 2004 Freddie Akeroyd <freddie.akeroyd@stfc.ac.uk>
#
Summary: Libraries and utilities for using NeXus format data files
Name: @PACKAGE_TARNAME@
Version: @PACKAGE_VERSION@
# Release is the number of times this version of the software was 
# built into an RPM file; it should be incremented each RPM build and
# then reset to 1 when a new version of the software is released
Release: @PACKAGE_RELEASE@
License: LGPL
# Group: there is more than one choice for this - maybe we need to split
# nexus into separate packages (libraries + apps)
Group: Development/Libraries
#Group: Development/Tools
Source: http://download.nexusformat.org/kits/@PACKAGE_TARNAME@-@PACKAGE_VERSION@.tar.gz
URL: http://www.nexusformat.org/
Distribution: @DISTRIBUTION@
#Icon: nexus.xpm
Vendor: NeXus International Advisory Committee (NIAC)
Packager: NeXus Developers <nexus-developers@nexusformat.org>
# Prefix allows our package to be relocatable i.e. installable in 
# other than just the /usr/local directory
#Prefix: /usr
# BuildRoot is the root for software installation
# this value will not usually be used, but something must
# be specified here to allow   rpm --buildroot   to be used later
# (it will get used for a   rpmbuild --recompile  of the the src.rpm)
BuildRoot: %{_tmppath}/@PACKAGE_TARNAME@-@PACKAGE_VERSION@

%description
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides
access routines, documentation, examples and a basic NeXus file browser.

%package devel
Summary: Libraries and utilities for using NeXus format data files
Group: Development/Libraries

%description devel
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides

%package tools
Summary: Libraries and utilities for using NeXus format data files
Group: Development/Libraries

%description tools
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides

%package doc
Summary: Libraries and utilities for using NeXus format data files
Group: Development/Libraries

%description doc
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides

%package python
Summary: Libraries and utilities for using NeXus format data files
Group: Development/Libraries

%description python
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides

%package java
Summary: Libraries and utilities for using NeXus format data files
Group: Development/Libraries

%description java
NeXus is an international standard for exchanging data files
among Neutron, Muon and X-ray science facilities. The underlying
data is stored using the HDF format from NCSA. This package provides

%prep
%setup -q

%build
# RPM_INSTALL_PREFIX - where to install software
if ! test -z "$RPM_INSTALL_PREFIX"; then
    ./configure --prefix="$RPM_INSTALL_PREFIX" $NEXUS_CONFIG_OPTIONS
else
    ./configure --prefix=%{_prefix} --libdir=%{_libdir} $NEXUS_CONFIG_OPTIONS
fi
make

%install
# RPM_BUILD_ROOT is where to install software to
if test "$RPM_BUILD_ROOT" != "/"; then rm -fr "$RPM_BUILD_ROOT"; fi
make DESTDIR="$RPM_BUILD_ROOT" install
find "$RPM_BUILD_ROOT" -name '*.la' -exec rm -f {} \;

%files
%defattr(-,root,root)
%doc README NEWS ChangeLog AUTHORS COPYING INSTALL
# %docdir /usr/local/doc
%{_libdir}/*.so*
#%ifarch x86_64
#/usr/lib/*.so*
#%endif

%files devel
%defattr(-,root,root)
%{_libdir}/*.a
%{_libdir}/pkgconfig
%{_includedir}/*

%files tools
%defattr(-,root,root)
%{_bindir}/*

%files doc
%defattr(-,root,root)
%{_datadir}/man
%{_datadir}/nexus

%files python
%defattr(-,root,root)
/usr/lib/python*/site-packages/nxs

%files java
%defattr(-,root,root)
%{_datadir}/java

%clean
if test "$RPM_BUILD_ROOT" != "/"; then rm -fr "$RPM_BUILD_ROOT"; fi

%post
if [ "$RPM_INSTALL_PREFIX" != "" ]; then
    INSTALL_PREFIX=$RPM_INSTALL_PREFIX
else
    INSTALL_PREFIX=%{_prefix}
fi

%post tools
( cd $INSTALL_PREFIX/bin; for i in nxbuild; do \
  sed -i -e "s|^prefix=.*|prefix=$INSTALL_PREFIX|" $i; done )
if test `whoami` = root; then ldconfig; fi

%postun
if test `whoami` = root; then ldconfig; fi
#
# %changelog date format as per  `date +"%a %d %b %Y"`
# first line should be   date  user  email
%changelog
* Sat Oct 22 2011 Freddie Akeroyd <freddie.akeroyd@stfc.ac.uk> - 4.3.0
- Split into subpackages
* Thu May 24 2007 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk> - 4.0.0
- Tag and build 4.0.0
* Wed May 16 2007 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk> - 4.0rc3
- Tag and build 4.0rc3
* Fri Mar 30 2007 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk> - 4.0rc2
- Tag and build 4.0rc2
* Thu Mar 15 2007 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk> - 4.0rc1
- Tag and build 4.0rc1
* Wed Jul 27 2005 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk>
- Change Copyright: to License: and add PACKAGE_RELEASE
* Mon Jun  6 2005 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk>
- Add extra documentation and example files to distribution
* Wed May 12 2004 Jens Krueger <jens.krueger@frm2.tum.de>
- Change the License entry to LGPL
- remove /usr/local/nexus /usr/local/doc from the file list
* Wed Mar 24 2004 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk>
- Fix up prefix in nxbuild after an install so the RPM is now relocatable
* Sun Feb 22 2004 Freddie Akeroyd <F.A.Akeroyd@rl.ac.uk>
- Initial RPM kit version
